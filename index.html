<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario ATRVT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .input-focus:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .status-indicator {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-lg mx-auto p-6">
        
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6 p-6">
            <div class="text-center">
                <h1 class="text-2xl font-semibold text-gray-900 mb-1">Formulario ATRVT</h1>
                <p class="text-gray-600 text-sm mb-4">Registro de Sesiones Terapéuticas</p>
                <div class="flex items-center justify-center gap-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full status-indicator"></div>
                    <span class="text-xs text-gray-500">Sistema activo</span>
                </div>
            </div>
        </div>

        <!-- Formulario -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 space-y-6">
            
            <!-- Datos de la sesión -->
            <div class="space-y-4">
                <h2 class="text-lg font-medium text-gray-900 pb-2 border-b border-gray-100">
                    Datos de la Sesión
                </h2>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Fecha</label>
                    <input 
                        type="date" 
                        id="fecha" 
                        class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200"
                    >
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Terapeuta</label>
                    <select 
                        id="terapeuta" 
                        class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 bg-white"
                    >
                        <option value="">Seleccionar terapeuta</option>
                        <option value="Adriana J">Adriana J</option>
                        <option value="Celeste M">Celeste M</option>
                        <option value="Cinthia">Cinthia</option>
                        <option value="Dani R">Dani R</option>
                        <option value="Estefanie">Estefanie</option>
                        <option value="Gaby A">Gaby A</option>
                        <option value="Gaby X">Gaby X</option>
                        <option value="Geovanna">Geovanna</option>
                        <option value="Jacky S">Jacky S</option>
                        <option value="Jessi G">Jessi G</option>
                        <option value="Jessica P">Jessica P</option>
                        <option value="Luisa D">Luisa D</option>
                        <option value="Melissa P">Melissa P</option>
                        <option value="Meli Peña">Meli Peña</option>
                        <option value="Paty">Paty</option>
                        <option value="Rocío M">Rocío M</option>
                        <option value="Suly S">Suly S</option>
                        <option value="Tere M">Tere M</option>
                        <option value="Zamy">Zamy</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Paciente</label>
                    <select 
                        id="nombre" 
                        class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 bg-white"
                    >
                        <option value="">Seleccionar paciente</option>
                        <option value="Abraham Chapetón">Abraham Chapetón</option>
                        <option value="Adolfo Hernández">Adolfo Hernández</option>
                        <option value="Adrián">Adrián</option>
                        <option value="Adriana García">Adriana García</option>
                        <option value="Amber Lafage">Amber Lafage</option>
                        <option value="Ana María">Ana María</option>
                        <option value="Andrei González">Andrei González</option>
                        <option value="Andrés Cruz">Andrés Cruz</option>
                        <option value="Ángel Gabriel">Ángel Gabriel</option>
                        <option value="Ángel Gudiel">Ángel Gudiel</option>
                        <option value="Bruno Arévalo">Bruno Arévalo</option>
                        <option value="Bruno Torres">Bruno Torres</option>
                        <option value="Christopher Gamas">Christopher Gamas</option>
                        <option value="Cristian Molina">Cristian Molina</option>
                        <option value="Daniel Samayoa">Daniel Samayoa</option>
                        <option value="Diego Lima">Diego Lima</option>
                        <option value="Diego Pérez">Diego Pérez</option>
                        <option value="Dylan Ceijas">Dylan Ceijas</option>
                        <option value="Ethan Forno">Ethan Forno</option>
                        <option value="Fabián Álvarez">Fabián Álvarez</option>
                        <option value="Gabriel Ruíz">Gabriel Ruíz</option>
                        <option value="Ivanna Recinos">Ivanna Recinos</option>
                        <option value="Javier Maldonado">Javier Maldonado</option>
                        <option value="Jorge Sánchez">Jorge Sánchez</option>
                        <option value="José Miguel López">José Miguel López</option>
                        <option value="Julio González">Julio González</option>
                        <option value="Luis André Arriola">Luis André Arriola</option>
                        <option value="Luis Felipe Guzmán">Luis Felipe Guzmán</option>
                        <option value="Mariana Solís">Mariana Solís</option>
                        <option value="Mateo Toribio">Mateo Toribio</option>
                        <option value="Mathías Mendoza">Mathías Mendoza</option>
                        <option value="Matías Contreras">Matías Contreras</option>
                        <option value="Matías Guaré">Matías Guaré</option>
                        <option value="Matías Osorio">Matías Osorio</option>
                        <option value="Miranda Martínez">Miranda Martínez</option>
                        <option value="Nicholas Mancilla">Nicholas Mancilla</option>
                        <option value="Pablo Vielman">Pablo Vielman</option>
                        <option value="René Torres">René Torres</option>
                        <option value="Rodrigo Chigüichon">Rodrigo Chigüichon</option>
                        <option value="Santiago Ruíz">Santiago Ruíz</option>
                        <option value="Tier Xitumul">Tier Xitumul</option>
                        <option value="Xander García">Xander García</option>
                    </select>
                </div>
            </div>

            <!-- Programa trabajado -->
            <div class="space-y-4">
                <h2 class="text-lg font-medium text-gray-900 pb-2 border-b border-gray-100">
                    Programa Trabajado
                </h2>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Programa</label>
                    <input 
                        type="text" 
                        id="programa" 
                        placeholder="Nombre del programa" 
                        class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200"
                    >
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5">Conj/Nivel</label>
                        <input 
                            type="number" 
                            id="conjNivel" 
                            placeholder="1" 
                            class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200"
                        >
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5">Elementos</label>
                        <input 
                            type="number" 
                            id="elementos" 
                            placeholder="20" 
                            class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200"
                        >
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5">Ensayos correctos</label>
                        <input 
                            type="number" 
                            id="ensayosPositivos" 
                            placeholder="0" 
                            class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200"
                        >
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5">Ensayos incorrectos</label>
                        <input 
                            type="number" 
                            id="ensayosNegativos" 
                            placeholder="0" 
                            class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200"
                        >
                    </div>
                </div>

                <!-- Resultado -->
                <div id="resultado" class="bg-blue-50 border border-blue-200 rounded-md p-4 text-center" style="display:none">
                    <div id="resultadoTexto" class="text-blue-800 font-medium"></div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Tipo de ayuda</label>
                    <select 
                        id="tipoAyuda" 
                        class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 bg-white"
                    >
                        <option value="">Seleccionar</option>
                        <option value="Ninguna">Ninguna</option>
                        <option value="Verbal">Verbal</option>
                        <option value="Gestual">Gestual</option>
                        <option value="Física parcial">Física parcial</option>
                        <option value="Física total">Física total</option>
                        <option value="Física sombra">Física sombra</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Tipo de reforzador</label>
                    <select 
                        id="tipoReforzador" 
                        class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 bg-white"
                    >
                        <option value="">Seleccionar</option>
                        <option value="Comestible">Comestible</option>
                        <option value="Sensorial">Sensorial</option>
                        <option value="Social">Social</option>
                        <option value="Tangible">Tangible</option>
                        <option value="Economía">Economía</option>
                        <option value="Actividad">Actividad</option>
                        <option value="Prueba/Test">Prueba/Test</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de reforzamiento</label>
                    <div class="flex gap-6">
                        <label class="flex items-center cursor-pointer">
                            <input 
                                type="radio" 
                                name="tipoReforzamiento" 
                                value="Continuo" 
                                class="mr-2 text-blue-600 focus:ring-blue-500"
                            >
                            <span class="text-sm text-gray-700">Continuo</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input 
                                type="radio" 
                                name="tipoReforzamiento" 
                                value="Variable" 
                                class="mr-2 text-blue-600 focus:ring-blue-500"
                            >
                            <span class="text-sm text-gray-700">Variable</span>
                        </label>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Comentarios</label>
                    <textarea 
                        id="comentario" 
                        placeholder="Observaciones de la sesión..." 
                        rows="3" 
                        class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 resize-none"
                    ></textarea>
                </div>
            </div>

            <!-- Botón enviar -->
            <div class="pt-4">
                <button 
                    id="guardarBtn" 
                    class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200 font-medium"
                >
                    Enviar sesión
                </button>
            </div>

            <!-- Status -->
            <div class="text-center pt-2">
                <span id="statusText" class="text-xs text-gray-500">Sistema listo</span>
            </div>
        </div>
    </div>

    <script>
        // Elementos del DOM
        const fechaInput = document.getElementById('fecha');
        const terapeutaSelect = document.getElementById('terapeuta');
        const nombreSelect = document.getElementById('nombre');
        const programaInput = document.getElementById('programa');
        const conjNivelInput = document.getElementById('conjNivel');
        const elementosInput = document.getElementById('elementos');
        const ensayosPositivosInput = document.getElementById('ensayosPositivos');
        const ensayosNegativosInput = document.getElementById('ensayosNegativos');
        const tipoAyudaSelect = document.getElementById('tipoAyuda');
        const tipoReforzadorSelect = document.getElementById('tipoReforzador');
        const comentarioTextarea = document.getElementById('comentario');
        const guardarBtn = document.getElementById('guardarBtn');
        const resultadoDiv = document.getElementById('resultado');
        const resultadoTexto = document.getElementById('resultadoTexto');
        const statusText = document.getElementById('statusText');

        // Funciones
        function inicializar() {
            fechaInput.value = new Date().toISOString().split('T')[0];
        }

        function calcularResultados() {
            const positivos = parseInt(ensayosPositivosInput.value) || 0;
            const negativos = parseInt(ensayosNegativosInput.value) || 0;
            const total = positivos + negativos;
            
            if (total > 0) {
                const porcentaje = Math.round((positivos / total) * 100);
                resultadoTexto.textContent = `${total} ensayos totales • ${porcentaje}% de aciertos`;
                resultadoDiv.style.display = 'block';
                
                // Cambiar color según resultado
                if (porcentaje >= 80) {
                    resultadoDiv.className = 'bg-green-50 border border-green-200 rounded-md p-4 text-center';
                    resultadoTexto.className = 'text-green-800 font-medium';
                } else if (porcentaje >= 60) {
                    resultadoDiv.className = 'bg-yellow-50 border border-yellow-200 rounded-md p-4 text-center';
                    resultadoTexto.className = 'text-yellow-800 font-medium';
                } else {
                    resultadoDiv.className = 'bg-red-50 border border-red-200 rounded-md p-4 text-center';
                    resultadoTexto.className = 'text-red-800 font-medium';
                }
            } else {
                resultadoDiv.style.display = 'none';
            }
        }

        function limpiarFormulario() {
            programaInput.value = '';
            conjNivelInput.value = '';
            elementosInput.value = '';
            ensayosPositivosInput.value = '';
            ensayosNegativosInput.value = '';
            tipoAyudaSelect.value = '';
            tipoReforzadorSelect.value = '';
            comentarioTextarea.value = '';
            document.querySelectorAll('input[name="tipoReforzamiento"]').forEach(radio => radio.checked = false);
            resultadoDiv.style.display = 'none';
        }

        function validarFormulario() {
            if (!fechaInput.value || !terapeutaSelect.value || !nombreSelect.value || 
                !programaInput.value || !conjNivelInput.value || !elementosInput.value ||
                ensayosPositivosInput.value === '' || ensayosNegativosInput.value === '' ||
                !tipoAyudaSelect.value || !tipoReforzadorSelect.value) {
                alert('Por favor complete todos los campos requeridos');
                return false;
            }

            const tipoReforzamiento = document.querySelector('input[name="tipoReforzamiento"]:checked');
            if (!tipoReforzamiento) {
                alert('Por favor seleccione el tipo de reforzamiento');
                return false;
            }

            return true;
        }

        // Event Listeners
        ensayosPositivosInput.addEventListener('input', calcularResultados);
        ensayosNegativosInput.addEventListener('input', calcularResultados);

        guardarBtn.addEventListener('click', async function() {
            if (!validarFormulario()) return;

            const tipoReforzamiento = document.querySelector('input[name="tipoReforzamiento"]:checked');
            
            const programa = {
                id: Date.now(),
                programa: programaInput.value,
                conjNivel: conjNivelInput.value,
                elementos: elementosInput.value,
                ensayosPositivos: ensayosPositivosInput.value,
                ensayosNegativos: ensayosNegativosInput.value,
                tiposAyuda: [tipoAyudaSelect.value],
                tiposReforzador: [tipoReforzadorSelect.value],
                tipoReforzamiento: tipoReforzamiento.value,
                tiempoColegio: '',
                tiempoEntrenamientoPapas: '',
                comportamientoRelevante: '',
                comentario: comentarioTextarea.value
            };

            const sesion = {
                id: Date.now(),
                fecha: fechaInput.value,
                terapeuta: terapeutaSelect.value,
                nombre: nombreSelect.value,
                programas: [programa]
            };

            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwMXhSh10UNE2hohfjAnqDhNClKKOepQPAOyHbYPAt6kE_fvCrePSYmYxQvkOC-VnSS/exec';

            guardarBtn.textContent = 'Enviando...';
            guardarBtn.disabled = true;
            statusText.textContent = 'Enviando datos...';

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(sesion)
                });
                
                const result = await response.json();
                if (result.success) {
                    limpiarFormulario();
                    statusText.textContent = 'Sesión enviada correctamente';
                    alert('Sesión enviada correctamente');
                } else {
                    throw new Error(result.error || 'Error desconocido');
                }
                
            } catch (error) {
                console.error('Error:', error);
                statusText.textContent = 'Error al enviar';
                alert('Error al enviar los datos. Verifique su conexión e intente nuevamente.');
            } finally {
                guardarBtn.textContent = 'Enviar sesión';
                guardarBtn.disabled = false;
            }
        });

        // Inicializar
        inicializar();
    </script>
</body>
</html>
