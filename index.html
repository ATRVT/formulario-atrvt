<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario ATRVT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .input-focus:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .status-indicator {
            animation: pulse 2s infinite;
        }
        .programa-card {
            transition: all 0.2s ease;
        }
        .programa-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-lg mx-auto p-6">
        
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6 p-6">
            <div class="text-center">
                <h1 class="text-2xl font-semibold text-gray-900 mb-1">Formulario ATRVT</h1>
                <p class="text-gray-600 text-sm mb-4">Registro de Sesiones Terap√©uticas</p>
                <div class="flex items-center justify-center gap-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full status-indicator"></div>
                    <span class="text-xs text-gray-500">Sistema activo</span>
                </div>
            </div>
        </div>

        <!-- Formulario -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 space-y-6">
            
            <!-- Datos de la sesi√≥n -->
            <div class="space-y-4">
                <h2 class="text-lg font-medium text-gray-900 pb-2 border-b border-gray-100">
                    Datos de la Sesi√≥n
                </h2>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Fecha</label>
                    <input 
                        type="date" 
                        id="fecha" 
                        class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200"
                    >
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Terapeuta</label>
                    <select 
                        id="terapeuta" 
                        class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 bg-white"
                    >
                        <option value="">Seleccionar terapeuta</option>
                        <option value="Adriana J">Adriana J</option>
                        <option value="Celeste M">Celeste M</option>
                        <option value="Cinthia">Cinthia</option>
                        <option value="Dani R">Dani R</option>
                        <option value="Estefanie">Estefanie</option>
                        <option value="Gaby A">Gaby A</option>
                        <option value="Gaby X">Gaby X</option>
                        <option value="Geovanna">Geovanna</option>
                        <option value="Jacky S">Jacky S</option>
                        <option value="Jessi G">Jessi G</option>
                        <option value="Jessica P">Jessica P</option>
                        <option value="Luisa D">Luisa D</option>
                        <option value="Melissa P">Melissa P</option>
                        <option value="Meli Pe√±a">Meli Pe√±a</option>
                        <option value="Paty">Paty</option>
                        <option value="Roc√≠o M">Roc√≠o M</option>
                        <option value="Suly S">Suly S</option>
                        <option value="Tere M">Tere M</option>
                        <option value="Zamy">Zamy</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Estudiante</label>
                    <select 
                        id="nombre" 
                        class="w-full px-3 py-2.5 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 bg-white"
                    >
                        <option value="">Seleccionar estudiante</option>
                        <option value="Abraham Chapet√≥n">Abraham Chapet√≥n</option>
                        <option value="Adolfo Hern√°ndez">Adolfo Hern√°ndez</option>
                        <option value="Adri√°n">Adri√°n</option>
                        <option value="Adriana Garc√≠a">Adriana Garc√≠a</option>
                        <option value="Amber Lafage">Amber Lafage</option>
                        <option value="Ana Mar√≠a">Ana Mar√≠a</option>
                        <option value="Andrei Gonz√°lez">Andrei Gonz√°lez</option>
                        <option value="Andr√©s Cruz">Andr√©s Cruz</option>
                        <option value="√Ångel Gabriel">√Ångel Gabriel</option>
                        <option value="√Ångel Gudiel">√Ångel Gudiel</option>
                        <option value="Bruno Ar√©valo">Bruno Ar√©valo</option>
                        <option value="Bruno Torres">Bruno Torres</option>
                        <option value="Christopher Gamas">Christopher Gamas</option>
                        <option value="Cristian Molina">Cristian Molina</option>
                        <option value="Daniel Samayoa">Daniel Samayoa</option>
                        <option value="Diego Lima">Diego Lima</option>
                        <option value="Diego P√©rez">Diego P√©rez</option>
                        <option value="Dylan Ceijas">Dylan Ceijas</option>
                        <option value="Ethan Forno">Ethan Forno</option>
                        <option value="Fabi√°n √Ålvarez">Fabi√°n √Ålvarez</option>
                        <option value="Gabriel Ru√≠z">Gabriel Ru√≠z</option>
                        <option value="Ivanna Recinos">Ivanna Recinos</option>
                        <option value="Javier Maldonado">Javier Maldonado</option>
                        <option value="Jorge S√°nchez">Jorge S√°nchez</option>
                        <option value="Jos√© Miguel L√≥pez">Jos√© Miguel L√≥pez</option>
                        <option value="Julio Gonz√°lez">Julio Gonz√°lez</option>
                        <option value="Luis Andr√© Arriola">Luis Andr√© Arriola</option>
                        <option value="Luis Felipe Guzm√°n">Luis Felipe Guzm√°n</option>
                        <option value="Mariana Sol√≠s">Mariana Sol√≠s</option>
                        <option value="Mateo Toribio">Mateo Toribio</option>
                        <option value="Math√≠as Mendoza">Math√≠as Mendoza</option>
                        <option value="Mat√≠as Contreras">Mat√≠as Contreras</option>
                        <option value="Mat√≠as Guar√©">Mat√≠as Guar√©</option>
                        <option value="Mat√≠as Osorio">Mat√≠as Osorio</option>
                        <option value="Miranda Mart√≠nez">Miranda Mart√≠nez</option>
                        <option value="Nicholas Mancilla">Nicholas Mancilla</option>
                        <option value="Pablo Vielman">Pablo Vielman</option>
                        <option value="Ren√© Torres">Ren√© Torres</option>
                        <option value="Rodrigo Chig√ºichon">Rodrigo Chig√ºichon</option>
                        <option value="Santiago Ru√≠z">Santiago Ru√≠z</option>
                        <option value="Tier Xitumul">Tier Xitumul</option>
                        <option value="Xander Garc√≠a">Xander Garc√≠a</option>
                    </select>
                </div>
            </div>

            <!-- Programas trabajados -->
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-medium text-gray-900 pb-2 border-b border-gray-100 flex-grow">
                        Programas Trabajados
                    </h2>
                    <button 
                        id="agregarPrograma" 
                        class="ml-4 bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors"
                    >
                        + Agregar Programa
                    </button>
                </div>
                
                <div id="programasContainer" class="space-y-4">
                    <!-- Los programas se agregan aqu√≠ din√°micamente -->
                </div>
            </div>

            <!-- Bot√≥n enviar -->
            <div class="pt-4">
                <button 
                    id="guardarBtn" 
                    class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200 font-medium"
                >
                    Enviar sesi√≥n
                </button>
            </div>

            <!-- Status -->
            <div class="text-center pt-2">
                <span id="statusText" class="text-xs text-gray-500">Sistema listo</span>
            </div>
        </div>

        <!-- Panel de configuraci√≥n -->
        <div class="mt-6 bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Configuraci√≥n</h3>
            <div class="space-y-3">
                <button id="configurarTerapeutas" class="w-full text-left px-4 py-2 bg-gray-50 rounded hover:bg-gray-100 transition-colors text-sm">
                    üìã Gestionar Terapeutas
                </button>
                <button id="configurarEstudiantes" class="w-full text-left px-4 py-2 bg-gray-50 rounded hover:bg-gray-100 transition-colors text-sm">
                    üë• Gestionar Estudiantes
                </button>
                <button id="configurarProgramas" class="w-full text-left px-4 py-2 bg-gray-50 rounded hover:bg-gray-100 transition-colors text-sm">
                    üìö Gestionar Programas
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de configuraci√≥n -->
    <div id="configModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4" style="z-index: 1000;">
        <div class="bg-white rounded-lg max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-lg font-medium text-gray-900"></h3>
                <button id="cerrarModal" class="text-gray-400 hover:text-gray-600">‚úï</button>
            </div>
            <div id="modalContent" class="space-y-3">
                <!-- Contenido din√°mico -->
            </div>
            <div class="mt-6 flex gap-3">
                <button id="guardarConfig" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors">
                    Guardar
                </button>
                <button id="cancelarConfig" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded hover:bg-gray-400 transition-colors">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <script>
        // Datos configurables
        let config = {
            programas: [
                "Agilidad mental", "Aleatorio acciones", "Aleatorio b√∫squeda de objetos", "Aleatorio emociones", "Aleatorio dictado n√∫meros",
                "Aleatorio ecoicas fonemas", "Aleatorio intraverbales", "Aleatorio ecoicas palabras", "Aleatorio ecoicas silabas", "Aleatorio escolares",
                "Aleatorio espejo", "Aleatorio igualaci√≥n auditiva", "Aleatorio igualaci√≥n 3D", "Aleatorio imitaci√≥n con objeto", "Aleatorio imitaci√≥n c/s objeto",
                "Aleatorio imitaci√≥n sin objeto", "Aleatorio lectura comprensiva", "Aleatorio lectura palabras", "Aleatorio lectura sil√°bica", "Aleatorio partes del cuerpo",
                "Aleatorio seguimiento instrucciones c/objeto", "Aleatorio seguimiento instrucciones s/objeto", "Aleatorio tactos animales", "Aleatorio tactos comida", "Aleatorio tactos letras",
                "Aleatorio tactos n√∫meros", "Aleatorio tactos objetos", "Aprestamiento", "Asociaciones", "Autonom√≠a",
                "Autocl√≠ticos", "B√∫squeda de objetos", "Categor√≠as", "C√°lculo mental", "Colorear",
                "Comida", "Computaci√≥n", "Conceptos matem√°ticos", "Condicionamiento caras", "Condicionamiento colorear",
                "Condicionamiento encajables", "Condicionamiento en mesa", "Condicionamiento paleta", "Condicionamiento juegos", "Condicionamiento libros",
                "Condicionamiento libros en el suelo", "Condicionamiento plasticina", "Condicionamiento saltar", "Condicionamiento t√©mperas", "Condicionamiento rompecabezas",
                "Contacto visual", "Conteo", "Control postural", "Copia", "Copia bisil√°bica",
                "Corte de cabello", "De√≠cticos", "Deletreo", "Dictado", "Dictado letras",
                "Dictado n√∫meros", "Dictado teclado", "Dictado silabas", "Discriminaci√≥n", "Discriminaci√≥n auditiva",
                "Discriminaci√≥n y lectura de palabras", "Ecoica fonemas", "Ecoica frases", "Ecoica oraciones", "Ecoica palabras",
                "Ecoica secuencias", "Ecoica silabas", "Entrenamiento a padres", "Escritura", "Espera",
                "Esperar turno", "Flexibilidad", "Habilidades num√©ricas", "Historias", "Hojas de trabajo",
                "Igualaci√≥n 2D/2D", "Igualaci√≥n 2D/3D", "Igualaci√≥n 3D/3D", "Igualaci√≥n animales", "Igualaci√≥n auditiva",
                "Igualaci√≥n categor√≠as", "Igualaci√≥n comida", "Igualaci√≥n de colores", "Igualaci√≥n letras", "Igualaci√≥n n√∫meros",
                "Igualaci√≥n objetos", "Igualaci√≥n palabras", "Igualaci√≥n partes del cuerpo", "Igualaci√≥n silabas", "Igualaci√≥n t√°ctil",
                "Igualaci√≥n texto/foto", "Imitaci√≥n c/s objeto", "Imitaci√≥n con objeto", "Imitaci√≥n en espejo", "Imitaci√≥n sin objeto",
                "Interacci√≥n juguetes", "Interacci√≥n social", "Intercambio de reforzadores", "Intraverbales", "Lavado de dientes",
                "Lectura comprensiva", "Lectura global", "Lectura oraciones", "Lectura palabras", "Lectura sil√°bica",
                "Mandos", "Mandos actividades", "Mandos aversivos", "Mandos comestibles", "Mandos juguetes",
                "Mandos otros lugares", "Matem√°ticas", "Motor", "Motricidad fina", "Multiplicaciones",
                "N√∫mero/numeral", "Opuestos", "Oral motor", "Partes del cuerpo", "Praxias",
                "Pre-escritura", "Pre-escritura silabas", "Pre-lectura", "Pronombres", "Recortar",
                "Reloj", "Respuesta al nombre", "Restas", "Rimas", "Rompecabezas",
                "Secuencias", "Seguimiento instrucciones c/s objeto", "Seguimiento instrucciones con objeto", "Seguimiento instrucciones escritas", "Seguimiento instrucciones sin objeto",
                "Seguimiento de instrucciones vocales", "Selecci√≥n 2D", "Selecci√≥n 3D", "Selecci√≥n acci√≥n", "Selecci√≥n animales",
                "Selecci√≥n colores", "Selecci√≥n comida", "Selecci√≥n con caracter√≠sticas", "Selecci√≥n escolares", "Selecci√≥n fonemas",
                "Selecci√≥n letras", "Selecci√≥n n√∫meros", "Selecci√≥n objetos", "Selecci√≥n palabras", "Selecci√≥n partes del cuerpo",
                "Selecci√≥n silabas", "Selecci√≥n varios", "Se√±alar cuaderno", "Sumas", "Tacto acciones",
                "Tacto animales", "Tacto colores", "Tacto comida", "Tacto emociones", "Tacto escolares",
                "Tacto impuro n√∫meros", "Tacto letras", "Tactos lugares", "Tacto n√∫meros", "Tacto objetos",
                "Tacto personas", "Tacto profesiones", "Tacto puro n√∫meros", "Tacto vestimenta", "Tactos sensoriales",
                "Tactos situaciones", "Tactos varios", "Tiempo Colegio", "Toma de perspectiva", "Tracking visual"
            ],
            terapeutas: ["Adriana J", "Celeste M", "Cinthia", "Dani R", "Estefanie", "Gaby A", "Gaby X", "Geovanna", "Jacky S", "Jessi G", "Jessica P", "Luisa D", "Melissa P", "Meli Pe√±a", "Paty", "Roc√≠o M", "Suly S", "Tere M", "Zamy"],
            estudiantes: ["Abraham Chapet√≥n", "Adolfo Hern√°ndez", "Adri√°n", "Adriana Garc√≠a", "Amber Lafage", "Ana Mar√≠a", "Andrei Gonz√°lez", "Andr√©s Cruz", "√Ångel Gabriel", "√Ångel Gudiel", "Bruno Ar√©valo", "Bruno Torres", "Christopher Gamas", "Cristian Molina", "Daniel Samayoa", "Diego Lima", "Diego P√©rez", "Dylan Ceijas", "Ethan Forno", "Fabi√°n √Ålvarez", "Gabriel Ru√≠z", "Ivanna Recinos", "Javier Maldonado", "Jorge S√°nchez", "Jos√© Miguel L√≥pez", "Julio Gonz√°lez", "Luis Andr√© Arriola", "Luis Felipe Guzm√°n", "Mariana Sol√≠s", "Mateo Toribio", "Math√≠as Mendoza", "Mat√≠as Contreras", "Mat√≠as Guar√©", "Mat√≠as Osorio", "Miranda Mart√≠nez", "Nicholas Mancilla", "Pablo Vielman", "Ren√© Torres", "Rodrigo Chig√ºichon", "Santiago Ru√≠z", "Tier Xitumul", "Xander Garc√≠a"]
        };

        // Cargar configuraci√≥n desde localStorage
        function cargarConfig() {
            try {
                const configGuardada = localStorage.getItem('atrvt_config');
                if (configGuardada) {
                    config = { ...config, ...JSON.parse(configGuardada) };
                }
            } catch (e) {
                console.log('Config por defecto');
            }
        }

        // Guardar configuraci√≥n
        function guardarConfig() {
            try {
                localStorage.setItem('atrvt_config', JSON.stringify(config));
            } catch (e) {
                console.log('No se pudo guardar config');
            }
        }

        // Variables globales
        let programasAgregados = [];
        let contadorProgramas = 0;

        // Elementos del DOM
        const fechaInput = document.getElementById('fecha');
        const terapeutaSelect = document.getElementById('terapeuta');
        const nombreSelect = document.getElementById('nombre');
        const programasContainer = document.getElementById('programasContainer');
        const agregarProgramaBtn = document.getElementById('agregarPrograma');
        const guardarBtn = document.getElementById('guardarBtn');
        const statusText = document.getElementById('statusText');

        // Modal
        const configModal = document.getElementById('configModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        const cerrarModal = document.getElementById('cerrarModal');
        const guardarConfigBtn = document.getElementById('guardarConfig');
        const cancelarConfigBtn = document.getElementById('cancelarConfig');

        // Funciones
        function inicializar() {
            cargarConfig();
            fechaInput.value = new Date().toISOString().split('T')[0];
            actualizarSelects();
            agregarPrograma(); // Agregar un programa por defecto
        }

        function actualizarSelects() {
            // Actualizar terapeutas
            terapeutaSelect.innerHTML = '<option value="">Seleccionar terapeuta</option>';
            config.terapeutas.forEach(terapeuta => {
                const option = document.createElement('option');
                option.value = terapeuta;
                option.textContent = terapeuta;
                terapeutaSelect.appendChild(option);
            });

            // Actualizar estudiantes
            nombreSelect.innerHTML = '<option value="">Seleccionar estudiante</option>';
            config.estudiantes.forEach(estudiante => {
                const option = document.createElement('option');
                option.value = estudiante;
                option.textContent = estudiante;
                nombreSelect.appendChild(option);
            });
        }

        function agregarPrograma() {
            contadorProgramas++;
            const programaId = `programa_${contadorProgramas}`;
            
            const programaDiv = document.createElement('div');
            programaDiv.className = 'bg-gray-50 rounded-lg p-4 programa-card border';
            programaDiv.id = programaId;

            programaDiv.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-medium text-gray-900">Programa ${contadorProgramas}</h4>
                    <button onclick="eliminarPrograma('${programaId}')" class="text-red-500 hover:text-red-700 text-sm">‚úï</button>
                </div>
                
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Programa</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 bg-white programa-select">
                            <option value="">Seleccionar programa</option>
                            ${config.programas.map(programa => `<option value="${programa}">${programa}</option>`).join('')}
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Conj/Nivel</label>
                            <input type="number" placeholder="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 conjnivel-input">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Elementos</label>
                            <input type="number" placeholder="20" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 elementos-input">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ensayos correctos</label>
                            <input type="number" placeholder="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 positivos-input">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ensayos incorrectos</label>
                            <input type="number" placeholder="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 negativos-input">
                        </div>
                    </div>

                    <div class="resultado bg-blue-50 border border-blue-200 rounded-md p-3 text-center hidden">
                        <div class="resultado-texto text-blue-800 font-medium"></div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de ayuda</label>
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 bg-white ayuda-select">
                                <option value="">Seleccionar</option>
                                <option value="Ninguna">Ninguna</option>
                                <option value="Verbal">Verbal</option>
                                <option value="Gestual">Gestual</option>
                                <option value="F√≠sica parcial">F√≠sica parcial</option>
                                <option value="F√≠sica total">F√≠sica total</option>
                                <option value="F√≠sica sombra">F√≠sica sombra</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de reforzador</label>
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 bg-white reforzador-select">
                                <option value="">Seleccionar</option>
                                <option value="Comestible">Comestible</option>
                                <option value="Sensorial">Sensorial</option>
                                <option value="Social">Social</option>
                                <option value="Tangible">Tangible</option>
                                <option value="Econom√≠a">Econom√≠a</option>
                                <option value="Actividad">Actividad</option>
                                <option value="Prueba/Test">Prueba/Test</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de reforzamiento</label>
                        <div class="flex gap-6">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="tipoReforzamiento_${contadorProgramas}" value="Continuo" class="mr-2 text-blue-600 focus:ring-blue-500">
                                <span class="text-sm text-gray-700">Continuo</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="tipoReforzamiento_${contadorProgramas}" value="Variable" class="mr-2 text-blue-600 focus:ring-blue-500">
                                <span class="text-sm text-gray-700">Variable</span>
                            </label>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tiempo colegio (min)</label>
                            <input type="number" placeholder="30" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 tiempo-colegio-input">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tiempo pap√°s (min)</label>
                            <input type="number" placeholder="15" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 tiempo-papas-input">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Comportamiento relevante</label>
                        <textarea placeholder="Describir comportamientos relevantes..." rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 resize-none comportamiento-textarea"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Comentarios</label>
                        <textarea placeholder="Observaciones del programa..." rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none input-focus transition-all duration-200 resize-none comentario-textarea"></textarea>
                    </div>
                </div>
            `;

            programasContainer.appendChild(programaDiv);

            // Agregar event listeners para calcular resultados
            const positivosInput = programaDiv.querySelector('.positivos-input');
            const negativosInput = programaDiv.querySelector('.negativos-input');
            
            positivosInput.addEventListener('input', () => calcularResultados(programaDiv));
            negativosInput.addEventListener('input', () => calcularResultados(programaDiv));
        }

        function eliminarPrograma(programaId) {
            if (programasContainer.children.length > 1) {
                document.getElementById(programaId).remove();
            } else {
                alert('Debe mantener al menos un programa');
            }
        }

        function calcularResultados(programaDiv) {
            const positivos = parseInt(programaDiv.querySelector('.positivos-input').value) || 0;
            const negativos = parseInt(programaDiv.querySelector('.negativos-input').value) || 0;
            const total = positivos + negativos;
            const resultadoDiv = programaDiv.querySelector('.resultado');
            const resultadoTexto = programaDiv.querySelector('.resultado-texto');
            
            if (total > 0) {
                const porcentaje = Math.round((positivos / total) * 100);
                resultadoTexto.textContent = `${total} ensayos ‚Ä¢ ${porcentaje}% aciertos`;
                resultadoDiv.classList.remove('hidden');
                
                // Cambiar color seg√∫n resultado
                if (porcentaje >= 80) {
                    resultadoDiv.className = 'resultado bg-green-50 border border-green-200 rounded-md p-3 text-center';
                    resultadoTexto.className = 'resultado-texto text-green-800 font-medium';
                } else if (porcentaje >= 60) {
                    resultadoDiv.className = 'resultado bg-yellow-50 border border-yellow-200 rounded-md p-3 text-center';
                    resultadoTexto.className = 'resultado-texto text-yellow-800 font-medium';
                } else {
                    resultadoDiv.className = 'resultado bg-red-50 border border-red-200 rounded-md p-3 text-center';
                    resultadoTexto.className = 'resultado-texto text-red-800 font-medium';
                }
            } else {
                resultadoDiv.classList.add('hidden');
            }
        }

        function recopilarProgramas() {
            const programas = [];
            const programaDivs = programasContainer.querySelectorAll('.programa-card');
            
            programaDivs.forEach((div, index) => {
                const tipoReforzamiento = div.querySelector(`input[name^="tipoReforzamiento"]:checked`);
                
                const programa = {
                    id: Date.now() + index,
                    programa: div.querySelector('.programa-select').value,
                    conjNivel: div.querySelector('.conjnivel-input').value,
                    elementos: div.querySelector('.elementos-input').value,
                    ensayosPositivos: div.querySelector('.positivos-input').value,
                    ensayosNegativos: div.querySelector('.negativos-input').value,
                    tiposAyuda: [div.querySelector('.ayuda-select').value],
                    tiposReforzador: [div.querySelector('.reforzador-select').value],
                    tipoReforzamiento: tipoReforzamiento ? tipoReforzamiento.value : '',
                    tiempoColegio: div.querySelector('.tiempo-colegio-input').value,
                    tiempoEntrenamientoPapas: div.querySelector('.tiempo-papas-input').value,
                    comportamientoRelevante: div.querySelector('.comportamiento-textarea').value,
                    comentario: div.querySelector('.comentario-textarea').value
                };
                
                programas.push(programa);
            });
            
            return programas;
        }

        function validarFormulario() {
            if (!fechaInput.value || !terapeutaSelect.value || !nombreSelect.value) {
                alert('Por favor complete fecha, terapeuta y estudiante');
                return false;
            }

            const programas = recopilarProgramas();
            for (let i = 0; i < programas.length; i++) {
                const prog = programas[i];
                if (!prog.programa || !prog.conjNivel || !prog.elementos || 
                    prog.ensayosPositivos === '' || prog.ensayosNegativos === '' ||
                    !prog.tiposAyuda[0] || !prog.tiposReforzador[0] || !prog.tipoReforzamiento) {
                    alert(`Por favor complete todos los campos del Programa ${i + 1}`);
                    return false;
                }
            }

            return true;
        }

        function limpiarFormulario() {
            // Limpiar datos b√°sicos (mantener fecha, terapeuta y estudiante)
            
            // Eliminar todos los programas excepto el primero
            const programaDivs = programasContainer.querySelectorAll('.programa-card');
            for (let i = 1; i < programaDivs.length; i++) {
                programaDivs[i].remove();
            }
            
            // Limpiar el primer programa
            const primerPrograma = programasContainer.querySelector('.programa-card');
            primerPrograma.querySelector('.programa-select').value = '';
            primerPrograma.querySelector('.conjnivel-input').value = '';
            primerPrograma.querySelector('.elementos-input').value = '';
            primerPrograma.querySelector('.positivos-input').value = '';
            primerPrograma.querySelector('.negativos-input').value = '';
            primerPrograma.querySelector('.ayuda-select').value = '';
            primerPrograma.querySelector('.reforzador-select').value = '';
            primerPrograma.querySelector('.tiempo-colegio-input').value = '';
            primerPrograma.querySelector('.tiempo-papas-input').value = '';
            primerPrograma.querySelector('.comportamiento-textarea').value = '';
            primerPrograma.querySelector('.comentario-textarea').value = '';
            primerPrograma.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
            primerPrograma.querySelector('.resultado').classList.add('hidden');
        }

        // Gesti√≥n de configuraci√≥n
        function abrirConfigModal(tipo) {
            modalTitle.textContent = `Gestionar ${tipo}`;
            modalContent.innerHTML = '';
            
            let items = [];
            let configKey = '';
            
            switch(tipo) {
                case 'Terapeutas':
                    items = config.terapeutas;
                    configKey = 'terapeutas';
                    break;
                case 'Estudiantes':
                    items = config.estudiantes;
                    configKey = 'estudiantes';
                    break;
                case 'Programas':
                    items = config.programas;
                    configKey = 'programas';
                    break;
            }
            
            modalContent.innerHTML = `
                <div class="space-y-3">
                    <div class="flex gap-2">
                        <input type="text" id="nuevoItem" placeholder="Agregar nuevo ${tipo.slice(0, -1).toLowerCase()}" 
                               class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none input-focus">
                        <button id="agregarItem" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">+</button>
                    </div>
                    <div class="max-h-60 overflow-y-auto space-y-2" id="listaItems">
                        ${items.map((item, index) => `
                            <div class="flex items-center justify-between bg-gray-50 px-3 py-2 rounded">
                                <span class="text-sm">${item}</span>
                                <button onclick="eliminarItem(${index}, '${configKey}')" class="text-red-500 hover:text-red-700 text-sm">‚úï</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            configModal.classList.remove('hidden');
            configModal.classList.add('flex');
            
            // Event listener para agregar item
            document.getElementById('agregarItem').onclick = () => agregarItem(configKey);
            document.getElementById('nuevoItem').onkeypress = (e) => {
                if (e.key === 'Enter') agregarItem(configKey);
            };
        }

        function agregarItem(configKey) {
            const input = document.getElementById('nuevoItem');
            const nuevoItem = input.value.trim();
            
            if (nuevoItem && !config[configKey].includes(nuevoItem)) {
                config[configKey].push(nuevoItem);
                input.value = '';
                actualizarListaItems(configKey);
            }
        }

        function eliminarItem(index, configKey) {
            config[configKey].splice(index, 1);
            actualizarListaItems(configKey);
        }

        function actualizarListaItems(configKey) {
            const listaItems = document.getElementById('listaItems');
            const items = config[configKey];
            
            listaItems.innerHTML = items.map((item, index) => `
                <div class="flex items-center justify-between bg-gray-50 px-3 py-2 rounded">
                    <span class="text-sm">${item}</span>
                    <button onclick="eliminarItem(${index}, '${configKey}')" class="text-red-500 hover:text-red-700 text-sm">‚úï</button>
                </div>
            `).join('');
        }

        function cerrarConfigModal() {
            configModal.classList.add('hidden');
            configModal.classList.remove('flex');
        }

        // Event Listeners
        agregarProgramaBtn.addEventListener('click', agregarPrograma);

        guardarBtn.addEventListener('click', async function() {
            if (!validarFormulario()) return;

            const programas = recopilarProgramas();
            
            const sesion = {
                id: Date.now(),
                fecha: fechaInput.value,
                terapeuta: terapeutaSelect.value,
                nombre: nombreSelect.value,
                programas: programas
            };

            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwwdPsvgoTta2iADBtiav8Wuk28TB5xX6EBIYDVYYylGvyxO7XZGntU-q8yZZEu7WA/exec';

            guardarBtn.textContent = 'Enviando...';
            guardarBtn.disabled = true;
            statusText.textContent = 'Enviando datos...';

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(sesion)
                });
                
                const result = await response.json();
                if (result.success) {
                    limpiarFormulario();
                    statusText.textContent = 'Sesi√≥n enviada correctamente';
                    alert('Sesi√≥n enviada correctamente');
                } else {
                    throw new Error(result.error || 'Error desconocido');
                }
                
            } catch (error) {
                console.error('Error:', error);
                statusText.textContent = 'Error al enviar';
                alert('Error al enviar los datos. Verifique su conexi√≥n e intente nuevamente.');
            } finally {
                guardarBtn.textContent = 'Enviar sesi√≥n';
                guardarBtn.disabled = false;
            }
        });

        // Event listeners del modal
        document.getElementById('configurarTerapeutas').addEventListener('click', () => abrirConfigModal('Terapeutas'));
        document.getElementById('configurarEstudiantes').addEventListener('click', () => abrirConfigModal('Estudiantes'));
        document.getElementById('configurarProgramas').addEventListener('click', () => abrirConfigModal('Programas'));

        cerrarModal.addEventListener('click', cerrarConfigModal);
        cancelarConfigBtn.addEventListener('click', cerrarConfigModal);

        guardarConfigBtn.addEventListener('click', () => {
            guardarConfig();
            actualizarSelects();
            cerrarConfigModal();
            alert('Configuraci√≥n guardada correctamente');
        });

        // Cerrar modal al hacer clic fuera
        configModal.addEventListener('click', (e) => {
            if (e.target === configModal) {
                cerrarConfigModal();
            }
        });

        // Hacer eliminarItem global para que funcione desde el HTML
        window.eliminarItem = eliminarItem;
        window.eliminarPrograma = eliminarPrograma;

        // Inicializar
        inicializar();
    </script>
</body>
</html>
